# 2019-02-11 (cc) <paul4hough@gmail.com>
#
---
maul::agate::config:
  agate:
    version: "%{lookup('maul::agate_version')}"
    config_dir: "%{lookup('maul::agate_config_dir')}"
    data_dir: "%{lookup('maul::agate_data_dir')}"
    config:
      listen-addr: ":%{lookup('maul::agate_port')}"
      ticket-default-sys: mock
      ticket-default-grp: user/project
      max-days: 15
      gitlab-url: https://localhost:1234/api/v4
      gitlab-token: secret-token
      hpsm-base-url: https://localhost:1234/api/v3
      hpsm-create-ep: incident2
      hpsm-update-ep: incident2
      hpsm-close-ep: incident3
      hpsm-user: hpsm
      hpsm-pass: pass
      mock-ticket-url: http://localhost:1234/ticket

maul::agate::vcs_scripts:
  "%{lookup('maul::agate_config_dir')}/scripts":
    ensure: present
    provider: git
    source: "%{lookup('maul::agate_scripts_repo')}"

maul::agate::lvm:
  lv_agate:
    pv: /dev/sdb
    vg: "%{lookup('maul::lvm_vg')}"
    fstype: xfs
    size: "%{lookup('maul::agate_lv_size')}"
    ensure: present

maul::agate::consul_svc:
  agate:
    port: "%{lookup('maul::agate_port')}"
    meta:
      mongrp: "%{facts.mongrp}"

maul::agate::firewall_cs:
  agate:
    short: agate
    description: agate alert gateway
    port:
      - port: "%{lookup('maul::agate_port')}"
        protocol: tcp

maul::agate::firewall_svc:
  agate:
    service: agate
    zone: "%{facts.firewall_zone}"
    ensure: present
