# 2019-02-11 (cc) <paul4hough@gmail.com>
#
---

maul::alertmanager::config:
  prometheus::alertmanager:
    version: "%{lookup('maul::alertmanager_version')}"
    storage_path: "%{lookup('maul::alertmanager_data_dir')}"
    global:
      resolve_timeout: 24h
    route:
      receiver: agate-resolve
      group_by:
        - alertname
        - instance
      repeat_interval: 168h
      routes:
        - receiver: agate-no-resolve
          match_re:
            no_resolve: '.*'
    receivers:
      - name: agate-no-resolve
        webhook_configs:
          - send_resolved: false
            url: "%{lookup('maul::agate_url')}"
      - name: agate-resolve
        webhook_configs:
          - send_resolved: true
            url: "%{lookup('maul::agate_url')}"

maul::alertmanager::lvm:
  lv_alertmanager:
    pv: /dev/sdb
    vg: "%{lookup('maul::lvm_vg')}"
    fstype: xfs
    size: "%{lookup('maul::alertmanager_lv_size')}"
    ensure: present

maul::alertmanager::consul_svc:
  alertmanager:
    port: "%{lookup('maul::alertmanager_port')}"
    meta:
      mongrp: "%{facts.mongrp}"

maul::alertmanager::firewall_cs:
  alertmanager:
    short: alertmanager
    description: prometheus alertmanager
    port:
      - port: "%{lookup('maul::alertmanager_port')}"
        protocol: tcp
      - port: "%{lookup('maul::alertmanager_cluster_port')}"
        protocol: tcp
      - port: "%{lookup('maul::alertmanager_cluster_port')}"
        protocol: udp

maul::alertmanager::firewall_svc:
  alertmanager:
    service: alertmanager
    zone: "%{facts.firewall_zone}"
    ensure: present
